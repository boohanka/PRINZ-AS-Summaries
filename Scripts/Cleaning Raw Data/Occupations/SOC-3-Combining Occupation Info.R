

rm(list = ls())

# ============================================================================#
# ============================================================================#
# ==== # ========================= Uploading =========================== # ====
# ============================================================================#
# ============================================================================#

df_as_soc <- read_csv("Data/Intermediate/SOC Flags - 1.csv")
df_lfs_weights <- read_csv("Data/Intermediate/LFS SOC3D Distribution.csv")

# ============================================================================#
# ============================================================================#
# ==== # ===================== Add Education Flag ====================== # ====
# ============================================================================#
# ============================================================================#

# SOC4D codes that require a PhD or Level 6 qualifications:

soc4d_code_univ <- c(
  "1115", "1121", "1122", "1123", "1131", "1132", "1133", "1134", "1135", "1136", "1139", "1150", "1161", 
  "1172", "1173", "1181", "1184", "2111", "2112", "2113", "2114", "2119", "2121", "2122", "2123", "2124", 
  "2126", "2127", "2129", "2133", "2134", "2135", "2136", "2137", "2139", "2141", "2142", "2150", "2211", 
  "2212", "2213", "2214", "2215", "2216", "2217", "2218", "2219", "2221", "2222", "2223", "2229", "2231", 
  "2232", "2311", "2312", "2314", "2315", "2316", "2317", "2318", "2319", "2412", "2413", "2419", "2421", 
  "2423", "2424", "2425", "2426", "2429", "2431", "2432", "2433", "2434", "2435", "2436", "2442", "2443", 
  "2449", "2451", "2452", "2461", "2462", "2463", "2471", "2472", "2473", "3213", "3415", "3416", "3512", 
  "3532", "3534", "3535", "3538", "3545"
)

df_as_soc %<>%
  mutate(
    lvl_6_7 = soc4d_code %in% soc4d_code_univ
  )

# ============================================================================#
# ============================================================================#
# ==== # ==================== Add Occupation Weights =================== # ====
# ============================================================================#
# ============================================================================#

df_as_soc %<>%
  left_join(
    df_lfs_weights, 
    join_by(soc3d_code == sc10mmn)
  )

# ============================================================================#
# ============================================================================#
# ==== # ========================== Export ============================== # ===
# ============================================================================#
# ============================================================================#

exporting_csv <- function(df, name, dir) {
  base_dir <- dir
  df_exp <- df
  exp_path <- file.path(base_dir, paste0(name, ".csv"))
  write.csv(df_exp, file = exp_path, row.names = FALSE)
}

exporting_csv(df_as_soc, "SOC Sample Selection", "Data/Cleaned/Occupations")